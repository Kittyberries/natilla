#Welcome the new player
title @s times 10t 3s 2s
execute if score language Config matches 0 run title @s subtitle [{"text":"Welcome, ","color":"#B5FFA6","italic":true},{"selector":"@s","color":"green","bold":true,"italic":true}]
execute if score language Config matches 1 run title @s subtitle [{"text":"Bienvenido/a, ","color":"#B5FFA6","italic":true},{"selector":"@s","color":"green","bold":true,"italic":true}]
title @s title [{"text":"⏩","color":"yellow"},{"text":" CTM Vanilla V4 ","color":"gold","bold":true},{"text":"⏪","color":"yellow","bold":false}]

execute if score language Config matches 0 run tellraw @s ["",{"text":"★⏵","color":"green"},{"text":" Welcome to "},{"text":"CTM Vanilla V4","bold":true,"color":"gold"},{"text":"!\n\n"},{"text":"☀⏵","color":"green"},{"text":" An original idea from "},{"text":"ElRichMC","color":"light_purple"},{"text":".\n"},{"text":"⛏⏵","color":"green"},{"text":" Programmed by "},{"text":"ByDagetaツ","color":"light_purple"},{"text":".\n\n"},{"text":"✉⏵","color":"green"},{"text":" You have received "},{"text":"some books","color":"dark_aqua"},{"text":": one with all the "},{"text":"information","color":"aqua"},{"text":" you'll need, another one to "},{"text":"start","color":"aqua"},{"text":" a game and the last one for the "},{"text":"configuration","color":"aqua"},{"text":"."}]
execute if score language Config matches 1 run tellraw @s ["",{"text":"★⏵","color":"green"},{"text":" Bienvenido/a a "},{"text":"CTM Vanilla V4","bold":true,"color":"gold"},{"text":"!\n\n"},{"text":"☀⏵","color":"green"},{"text":" Una idea original de "},{"text":"ElRichMC","color":"light_purple"},{"text":".\n"},{"text":"⛏⏵","color":"green"},{"text":" Programado por "},{"text":"ByDagetaツ","color":"light_purple"},{"text":".\n\n"},{"text":"✉⏵","color":"green"},{"text":" Has recibido "},{"text":"varios libros","color":"dark_aqua"},{"text":": uno con toda la "},{"text":"información","color":"aqua"},{"text":" que necesitas saber, otro para "},{"text":"empezar","color":"aqua"},{"text":" una partida y el último para la "},{"text":"configuración","color":"aqua"},{"text":"."}]

playsound entity.experience_orb.pickup player @s ~ ~ ~ 3 1 0
playsound block.conduit.activate player @s ~ ~ ~ 3 0.7 0
execute positioned ~ ~0.15 ~ run function ctmv:effects/expansive_circle_endrod
execute positioned ~ ~0.15 ~ run function ctmv:effects/ascending_circle_endrod

gamemode adventure @s
effect give @s saturation infinite 0 true
gamerule sendCommandFeedback false

#Give books to the player: information + configuration + start new game
execute if score language Config matches 0 run item replace entity @s hotbar.3 with written_book[written_book_content={pages:['["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n"},{"text":"  CTM VANILLA V4","bold":true,"color":"gold"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\n","color":"black"},{"text":"CTM Vanilla is a new gamemode thought by ElRichMC.","color":"dark_blue"},{"text":"\\n\\nLike any other CTM ","color":"black"},{"text":"(Complete The Monument)","italic":true,"color":"dark_gray"},{"text":", your objective is to find ","color":"black"},{"text":"16 different items","color":"dark_green"},{"text":", each representing a wool.","color":"black"}]','["",{"text":"\\nYou can find the items without a specific order using "},{"text":"whatever you need","color":"blue"},{"text":" (excluding cheats or glitches)","italic":true,"color":"dark_gray"},{"text":".\\n\\nAs having to do this task alone could be very challenging, ","color":"black"},{"text":"it is recommended to play with multiple players","color":"dark_green"},{"text":" (up to 8 players)","italic":true,"color":"dark_gray"},{"text":".","color":"black"}]','["",{"text":"\\nOnce you are "},{"text":"in game","color":"dark_aqua"},{"text":", you need to know that:\\n\\n- If you ","color":"black"},{"keybind":"key.sneak","color": "blue"},{"text":" 3 times in a row","color":"blue"},{"text":", a menu will appear in chat showing the items you are missing and buttons for ","color":"black"},{"text":"RESET","bold":true,"color":"dark_red"},{"text":" and ","color":"black"},{"text":"RESTING","bold":true,"color":"dark_green"},{"text":".\\n\\n","color":"black"},{"text":"(these buttons only appear to the admin)","italic":true,"color":"gray"}]','["",{"text":"\\n"},{"text":"CHAT MENU BUTTONS:","italic":true,"color":"dark_blue"},{"text":"\\n\\n✘⏵ ","color":"black"},{"text":"RESET","bold":true,"color":"dark_red"},{"text":": Game will stop and you will ","color":"black"},{"text":"lose all your progress","color":"red"},{"text":".\\n\\n⌂⏵ ","color":"black"},{"text":"RESTING","bold":true,"color":"dark_green"},{"text":": Game will pause for up to 5 minutes and you will be able to ","color":"black"},{"text":"do anything you want outside the game","color":"#42C300"},{"text":" without worrying.\\n ","color":"black"}]'],title:"",author:"CTM Vanilla"},custom_name='[{"text":"🛈","color":"aqua","italic":false},{"text":" Information ","color":"#CCFFFD","bold":true,"italic":false},{"text":"🛈","color":"aqua","italic":false}]']
execute if score language Config matches 1 run item replace entity @s hotbar.3 with written_book[written_book_content={pages:['["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n"},{"text":"  CTM VANILLA V4","bold":true,"color":"gold"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\n","color":"black"},{"text":"CTM Vanilla es un nuevo modo de juego pensado por ElRichMC.","color":"dark_blue"},{"text":"\\n\\nComo cualquier otro CTM ","color":"black"},{"text":"(Complete The Monument)","italic":true,"color":"dark_gray"},{"text":", tu objetivo es encontrar ","color":"black"},{"text":"16 ítems distintos","color":"dark_green"},{"text":", cada uno simbolizando una lana.","color":"black"}]','["",{"text":"\\nPuedes encontrar los objetos sin seguir un orden específico usando "},{"text":"todo lo que necesites","color":"blue"},{"text":" (excepto trucos o glitches)","italic":true,"color":"dark_gray"},{"text":".\\n\\nComo hacer esto solo podría ser muy difícil, ","color":"black"},{"text":"se recomiendo jugar con varias personas","color":"dark_green"},{"text":" (hasta 8 jugadores)","italic":true,"color":"dark_gray"},{"text":".","color":"black"}]','["",{"text":"\\nUna vez "},{"text":"en partida","color":"dark_aqua"},{"text":", debes saber que:\\n\\n- Si haces ","color":"black"},{"keybind":"key.sneak","color": "blue"},{"text":" 3 veces seguidas","color":"blue"},{"text":", un menú aparecerá en el chat mostrando los objetos restantes y botones de ","color":"black"},{"text":"REINICIO","bold":true,"color":"dark_red"},{"text":" y ","color":"black"},{"text":"DESCANSO","bold":true,"color":"dark_green"},{"text":".\\n\\n","color":"black"},{"text":"(botones solo admin)","italic":true,"color":"gray"}]','["",{"text":"\\n"},{"text":"BOTONES DEL CHAT:","italic":true,"color":"dark_blue"},{"text":"\\n\\n✘⏵ ","color":"black"},{"text":"REINICIAR","bold":true,"color":"dark_red"},{"text":": La partida terminará y ","color":"black"},{"text":"perderás todo tu progreso","color":"red"},{"text":".\\n\\n⌂⏵ ","color":"black"},{"text":"DESCANSAR","bold":true,"color":"dark_green"},{"text":": La partida se pausará por hasta 5 minutos y ","color":"black"},{"text":"podrás hacer lo que quieras fuera de esta","color":"#42C300"},{"text":" sin preocuparte.","color":"black"}]'],title:"",author:"CTM Vanilla"},custom_name='[{"text":"🛈","color":"aqua","italic":false},{"text":" Información ","color":"#CCFFFD","bold":true,"italic":false},{"text":"🛈","color":"aqua","italic":false}]']

function ctmv:lobby/update_books

#Set first player to join as ADMIN
execute unless entity @a[tag=admin] at @a run summon marker ~ ~ ~ {Tags:["prevent_exploring_on_lobby"]}
execute unless entity @a[tag=admin] run tag @a add admin
item replace entity @s[tag=admin] hotbar.4 with written_book[written_book_content={pages:['["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n  "},{"text":"STARTING A GAME","bold":true,"color":"gold"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\nHere you can vote for a ","color":"black"},{"text":"new game to start","color":"dark_green"},{"text":".\\n\\nYou should know that i","color":"black"},{"text":"t won\'t start until every player has voted","color":"dark_blue"},{"text":".\\n\\n","color":"black"},{"text":"[VOTE TO START GAME]","underlined":true,"color":"dark_purple","clickEvent":{"action":"run_command","value":"/trigger voteToStartGame"},"hoverEvent":{"action":"show_text","contents":["",{"text":"Click to "},{"text":"vote","color":"light_purple"},{"text":" for a new game to "},{"text":"start","color":"light_purple"}]}}]','["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n     "},{"text":"FORCE START","bold":true,"color":"dark_red"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\nIn this section you can ","color":"black"},{"text":"force the start of a new game","color":"red"},{"text":" (only you can see this page and click this button)","italic":true,"color":"dark_gray"},{"text":".\\n\\n  ","color":"black"},{"text":"[\\u26a0 START GAME \\u26a0]","underlined":true,"color":"dark_red","clickEvent":{"action":"run_command","value":"/trigger startGameWithoutVoting"},"hoverEvent":{"action":"show_text","contents":["",{"text":"Click to "},{"text":"start","color":"red"},{"text":" a new game "},{"text":"instantly","color":"red"}]}}]','["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n    "},{"text":"ADVANCEMENTS","bold":true,"color":"dark_green"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\nIf you want to ","color":"black"},{"text":"disable vanilla advancements","color":"dark_purple"},{"text":", you can press this button and ","color":"black"},{"text":"wait 2 minutes","color":"light_purple"},{"text":" while granting them to you.\\n\\n","color":"black"},{"text":"[GRANT ADVANCEMENTS]","underlined":true,"color":"dark_purple","clickEvent":{"action":"run_command","value":"/trigger GRANTADVANCEMENTS"},"hoverEvent":{"action":"show_text","contents":["",{"text":"Click to "},{"text":"grant every advancement","color":"light_purple"},{"text":" to all players"}]}}]'],title:"",author:"CTM Vanilla"},custom_name='[{"text":"⚔","color":"yellow","italic":false},{"text":" START GAME ","color":"gold","bold":true,"italic":false},{"text":"⚔","color":"yellow","italic":false}]']
execute if score language Config matches 0 run item replace entity @s[tag=!admin] hotbar.4 with written_book[written_book_content={pages:['["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n  "},{"text":"STARTING A GAME","bold":true,"color":"gold"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\nHere you can vote for a ","color":"black"},{"text":"new game to start","color":"dark_green"},{"text":".\\n\\nYou should know that i","color":"black"},{"text":"t won\'t start until every player has voted","color":"dark_blue"},{"text":".\\n\\n","color":"black"},{"text":"[VOTE TO START GAME]","underlined":true,"color":"dark_purple","clickEvent":{"action":"run_command","value":"/trigger voteToStartGame"},"hoverEvent":{"action":"show_text","contents":["",{"text":"Click to "},{"text":"vote","color":"light_purple"},{"text":" for a new game to "},{"text":"start","color":"light_purple"}]}}]'],title:"",author:"CTM Vanilla"},custom_name='[{"text":"⚔","color":"yellow","italic":false},{"text":" START GAME ","color":"gold","bold":true,"italic":false},{"text":"⚔","color":"yellow","italic":false}]']
execute if score language Config matches 1 run item replace entity @s[tag=!admin] hotbar.4 with written_book[written_book_content={pages:['["",{"text":"·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n  "},{"text":"EMPEZAR PARTIDA","bold":true,"color":"gold"},{"text":"\\n·-·-·-·-·-·-·-·-·-·-·-·-·-·-·\\n\\nAquí puedes votar para ","color":"black"},{"text":"empezar una nueva partida","color":"dark_green"},{"text":".\\n\\nDebes saber que ","color":"black"},{"text":"la partida no empezará hasta que todos hayan votado","color":"dark_blue"},{"text":".\\n\\n","color":"black"},{"text":"[VOTAR PARA EMPEZAR]","underlined":true,"color":"dark_purple","clickEvent":{"action":"run_command","value":"/trigger voteToStartGame"},"hoverEvent":{"action":"show_text","contents":["",{"text":"Click para "},{"text":"votar","color":"light_purple"},{"text":" para que "},{"text":"empiece","color":"light_purple"},{"text":" una nueva partida"}]}}]'],title:"",author:"CTM Vanilla"},custom_name='[{"text":"⚔","color":"yellow","italic":false},{"text":" EMPEZAR PARTIDA ","color":"gold","bold":true,"italic":false},{"text":"⚔","color":"yellow","italic":false}]']

#Initialize Items scoreboard on sidebar 
function ctmv:items_scoreboard/setup

#Add tag so that the player cannot be welcomed anymore
tag @s add welcomed